<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventario Cosmético (Administrador)</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
</head>

<body>
  <!-- Header: título a la izquierda, usuario e iconos a la derecha -->

  <div class="app-header d-flex align-items-center justify-content-between px-4 py-3" style="background: #365a66;">
    <div class="d-flex align-items-center">
      <span style="font-size:2em; font-weight:bold; color:#fff;">Inventario de Insumos de Cosmética (Vista Administrador)</span>
    </div>
    <div class="d-flex align-items-center gap-2">
      <img src="/img/usuario.webp" alt="Usuario" class="user-icon" style="width: 40px; height: 40px; border-radius: 50%; background: #fff; border: 2px solid #fff;">
      <span class="username ms-2" style="font-size: 1.2em; font-weight: bold; color: #fff;">
        <%= user?.nombre || user?.userName || 'Usuario' %>
      </span>
      <button id="logout-icon" class="btn btn-link p-0 ms-3" title="Cerrar sesión" style="color: #fff; font-size: 1.5em;" onclick="cerrarSesion()">
        <i class="fas fa-right-from-bracket"></i>
      </button>
    </div>
  </div>

  <div class="admin-container" style="background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); max-width: 1200px; margin: 40px auto;">
    <div class="h2-wrapper">
      <h2 style="text-align: center; margin-bottom: 24px;">Inventario de Insumos de Cosmética</h2>
      <div class="alert alert-info">
        <i class="fas fa-info-circle"></i> Vista de solo lectura para administradores. Para hacer cambios, contacte al personal de cosmética.
      </div>
      <div class="d-flex justify-content-between mb-3">
        <a href="/adminventario" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Volver al Dashboard
        </a>
        <button id="btnExportarExcel" class="btn btn-success">
          <i class="fas fa-file-excel"></i> Exportar a Excel
        </button>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-bordered table-striped table-hover" id="tablaInventario">
            <thead class="thead-dark">
              <tr>
                <th>Nombre SKU</th>
                <th>Capuchones</th>
                <th>Bases</th>
                <th>Tapas</th>
                <th>Total General</th>
              </tr>
            </thead>
            <tbody>
              <% if (Object.keys(inventario).length === 0) { %>
                <tr>
                  <td colspan="5" class="text-center">No hay datos de inventario disponibles</td>
                </tr>
              <% } else { %>
                <% Object.values(inventario).forEach(item => { 
                     const total = item.CAPUCHONES + item.BASES + item.TAPAS;
                %>
                  <tr>
                    <td><%= item.nombre || item.skuNombre || item.skuItem %></td>
                    <td><%= item.CAPUCHONES %></td>
                    <td><%= item.BASES %></td>
                    <td><%= item.TAPAS %></td>
                    <td><%= total %></td>
                  </tr>
                <% }) %>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
  <script src="/js/cerrarsesion.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Función para exportar la tabla a Excel
      document.getElementById('btnExportarExcel').addEventListener('click', function() {
        // Crear un libro de trabajo
        const wb = XLSX.utils.book_new();
        
        // Convertir la tabla a una hoja de cálculo
        const table = document.getElementById('tablaInventario');
        const ws = XLSX.utils.table_to_sheet(table);
        
        // Añadir la hoja al libro
        XLSX.utils.book_append_sheet(wb, ws, "Inventario Cosmética");
        
        // Generar el archivo y descargarlo
        const fechaActual = new Date().toISOString().slice(0,10);
        XLSX.writeFile(wb, `Inventario_Cosmetica_${fechaActual}.xlsx`);
      });
      
      // Asegurarnos de que el botón de regresar funcione correctamente
      document.querySelector('a[href="/adminventario"]').addEventListener('click', function(e) {
        e.preventDefault();
        window.location.href = '/adminventario';
      });
    });
  </script>
</body>
</html>
